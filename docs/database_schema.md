# Database Schema Documentation

## Unified NEXUS Platform Database Schema

This document provides an overview of the unified database schema for the NEXUS Platform, primarily defined in `backend/database/schema.sql`.

### Overview

The unified schema aims to consolidate all data models across various services into a single, consistent source of truth. It includes tables for user management, core application data, SSOT (Single Source of Truth) components, and various operational metrics and logs.

### Key Components and Relationships

#### Core Tables (Examples from `schema.sql`):

- **`users`**: Manages user accounts, authentication details, and profiles.
- **`roles`**: Defines user roles and their associated permissions.
- **`permissions`**: Granular permissions that can be assigned to roles.
- **`products`**: Information about products or services offered by the platform.
- **`orders`**: Records of customer orders.
- **`order_items`**: Details of items within each order.

#### SSOT Specific Tables (from `backend/database/models/ssot_models.py`):

- **`ssot_anchors`**: Core SSOT entities, representing a single source of truth for critical data points.
  - `id`: Unique identifier for the anchor.
  - `family`: Category or group the anchor belongs to.
  - `description`: Detailed explanation of the anchor.
  - `format`: Data format of the anchor (e.g., JSON, XML).
  - `version`: Version of the anchor definition.
  - `location`: Storage location or API endpoint for the anchor.
  - `metadata_`: Additional metadata in JSON format.
  - `tags`: Tags for categorization and search.
  - `status`: Current status (e.g., active, deprecated).

- **`alias_definitions`**: Maps human-readable aliases to canonical SSOT anchor identifiers.
  - `alias`: The human-readable alias.
  - `canonical`: The canonical identifier (e.g., SSOT Anchor ID, URL).
  - `context`: The operational context where the alias is valid (e.g., frontend, backend, global).
  - `alias_type`: Type of alias (e.g., API, service, data).
  - `description`: Description of the alias.
  - `created_by`: User or system that created the alias.
  - `created_at`: Timestamp of creation.
  - `expires_at`: Optional expiration timestamp.
  - `status`: Current status (e.g., active, inactive, expired).
  - `metadata_`: Additional metadata in JSON format.
  - `usage_count`: Number of times the alias has been used.
  - `last_used`: Timestamp of last usage.

- **`audit_log`**: Records all significant changes and operations within the SSOT system.
  - `id`: Unique identifier for the audit entry.
  - `timestamp`: When the event occurred.
  - `action`: Type of action (e.g., create, update, delete).
  - `user`: User or system performing the action.
  - `resource`: The resource affected (e.g., alias_name, anchor_id).
  - `details`: JSON blob with additional details of the change.
  - `request_id`: Identifier for the request that triggered the action.

### Schema Evolution and Migrations

Database schema evolution is managed using Alembic. Migration scripts are located in `backend/database/migrations/versions/`. New changes to the SQLAlchemy models (`backend/database/models/ssot_models.py`) should be reflected in new migration scripts generated by Alembic.

### Data Integrity and Constraints

The schema includes various constraints (Primary Keys, Foreign Keys, Unique Constraints) to ensure data integrity and consistency across the platform.

---

**Note**: For the most up-to-date and detailed schema definition, please refer directly to `backend/database/schema.sql` and the SQLAlchemy model definitions in `backend/database/models/`.
