global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "alerts.yml"

scrape_configs:
  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

  - job_name: "api-gateway"
    static_configs:
      - targets: ["api-gateway:8001"]
    metrics_path: "/metrics"
    scrape_interval: 5s

  - job_name: "user-service"
    static_configs:
      - targets: ["user-service:8001"]
    metrics_path: "/metrics"
    scrape_interval: 5s

  - job_name: "transaction-service"
    static_configs:
      - targets: ["transaction-service:8001"]
    metrics_path: "/metrics"
    scrape_interval: 5s

  - job_name: "analytics-service"
    static_configs:
      - targets: ["analytics-service:8001"]
    metrics_path: "/metrics"
    scrape_interval: 10s

  - job_name: "audit-service"
    static_configs:
      - targets: ["audit-service:8001"]
    metrics_path: "/metrics"
    scrape_interval: 5s

  - job_name: "notification-service"
    static_configs:
      - targets: ["notification-service:8001"]
    metrics_path: "/metrics"
    scrape_interval: 5s

  - job_name: "fraud-service"
    static_configs:
      - targets: ["fraud-service:8001"]
    metrics_path: "/metrics"
    scrape_interval: 5s

  - job_name: "performance-service"
    static_configs:
      - targets: ["performance-service:8001"]
    metrics_path: "/metrics"
    scrape_interval: 5s

  - job_name: "risk-service"
    static_configs:
      - targets: ["risk-service:8001"]
    metrics_path: "/metrics"
    scrape_interval: 5s

  - job_name: "compliance-service"
    static_configs:
      - targets: ["compliance-service:8001"]
    metrics_path: "/metrics"
    scrape_interval: 5s

  - job_name: "auth-service"
    static_configs:
      - targets: ["auth-service:8001"]
    metrics_path: "/metrics"
    scrape_interval: 5s

  - job_name: "backup-service"
    static_configs:
      - targets: ["backup-service:8001"]
    metrics_path: "/metrics"
    scrape_interval: 30s

  - job_name: "threat-detection"
    static_configs:
      - targets: ["threat-detection:8001"]
    metrics_path: "/metrics"
    scrape_interval: 5s

  # Database monitoring
  - job_name: "postgres-exporter"
    static_configs:
      - targets: ["postgres-exporter:9187"]

  # Redis monitoring
  - job_name: "redis-exporter"
    static_configs:
      - targets: ["redis-exporter:9121"]

  # Node exporter for system metrics
  - job_name: "node-exporter"
    static_configs:
      - targets: ["node-exporter:9100"]

  # Kubernetes monitoring
  - job_name: "kubernetes-nodes"
    kubernetes_sd_configs:
      - role: node
    scheme: https
    tls_config:
      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
      insecure_skip_verify: true
    bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token

  - job_name: "kubernetes-pods"
    kubernetes_sd_configs:
      - role: pod
    relabel_configs:
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
        action: keep
        regex: true
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
        action: replace
        target_label: __metrics_path__
        regex: (.+)
      - source_labels:
          [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
        action: replace
        regex: ([^:]+)(?::\d+)?;(\d+)
        replacement: $1:$2
        target_label: __address__
      - action: labelmap
        regex: __meta_kubernetes_pod_label_(.+)
      - source_labels: [__meta_kubernetes_namespace]
        action: replace
        target_label: kubernetes_namespace
      - source_labels: [__meta_kubernetes_pod_name]
        action: replace
        target_label: kubernetes_pod_name
